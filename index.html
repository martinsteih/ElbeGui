<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="GUI zur Erstellung von ELBE Konfigurationen">
<title>Elbe GUI</title>
<link href="css/styles.css" rel="stylesheet" type="text/css">
<script type="application/javascript" src="https://unpkg.com/react@16.0.0/umd/react.production.min.js"></script>
<script type="application/javascript" src="https://unpkg.com/react-dom@16.0.0/umd/react-dom.production.min.js"></script>
<script type="application/javascript" src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>
<script type="application/javascript" src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>
<header>
  <h1>ELBE GUI</h1>
  <div class="burger-menu"><img src="images/Burger_Menu.svg" alt="Elbe Gui Menu Button"/></div>
</header>
<div class="container">
  <nav>
    <div class="button button-active">Start</div>
	<div class="button">Configure</div>
    <div class="button">Build</div>
    <div class="button">Store</div>
    <div class="button">Manage</div>
    <div class="button">Learn</div>
  </nav>
  <main id="root">
  </main>
  <script type="text/babel">

function ListItem(props){
    return(
      <li className="list-item">
        <img className="more-btn" src="images/SVG/More_Btn.svg" alt="Show more button"/>
        {props.projectName}
      </li>
    );
  }

  class CreateProject extends React.Component{
    constructor(props){
      super(props);
      this.state={
        projectName : '',
        projectDescription : '',
        isNameSet : false,
      };
    }

    updateName(e){
      this.setState(
        {
          projectName : e.target.value,
          isNameSet : e.target.value ? true : false,
        }
      );
    }

    updateDescription(e){
      this.setState(
        {
          projectDescription : e.target.value,
        }
      );
    }

    render(){
      const create = this.state.isNameSet ? <div className="button-dlg" onClick={() => this.props.handleCreate(this.state.projectName, this.state.projectDescription)}>Create</div> : <div className="button-dlg button-dlg-disabled">Create</div>;
      return(
        <div>
        <div className="dlg">
        <div className="row">
          <input type="text" placeholder="enter project name" value={this.state.projectName} onChange={(e) => this.updateName(e)} />
        </div>
        <div className="row">
          <textarea placeholder="enter project description" value={this.state.projectDescription} onChange={(e) => this.updateDescription(e)}></textarea>
        </div>
        <div className="row">
          {create}
          <div className="button-dlg" id="btn-cancel" onClick={() => this.props.handleCancel()}>Cancel</div>
        </div>
      </div>
      </div>
      );
    }
  }

  class ElbeGuiApp extends React.Component{
    constructor(props){
      super(props);
      this.state={
        projects : Array(),
        isCreateProjectDialogVisible : false,
        isCreateProjectFailed : false,
      };
    }

    handleCancel(){
      this.setState({
        isCreateProjectDialogVisible : false,
      });
    }
    handleCreate(name, description){
      axios({
        url: 'http://localhost:80/api/addproject.php',
        method: 'post',
        mode: 'no-cors',
        data: {
          name: name,
          description: description
        },
        headers: {
          'accept' : 'application/json',
          'Content-Type' : 'application/json',
          'Access-Contol-Allow-Origin': '*'
        }
      }).then((response) => {
        this.setState(
        {
          projects : response.data,
          isCreateProjectDialogVisible : false,
        }
      );
      }).catch((error) => {
        //ToDo: Add an error message dialog informing the user that the data could not been fetched while leaving the createProjectDialog open
        console.log(error);
        this.setState(
          {
            isCreateProjectFailed : true,
          }
        );
      });
    }

    render(){
      const items = this.state.projects.map((step, item) => {
        return(
        <ListItem key={item} projectName={this.state.projects[item].projectName} />
        );
      });
      const createProjectDialog = this.state.isCreateProjectDialogVisible ? <CreateProject handleCancel={() => this.handleCancel()} handleCreate={(name, description) => this.handleCreate(name, description)}/> : null;
      const failedMessage = this.state.isCreateProjectFailed ? <div>Failed</div> : null;//ToDo: Error Dialog Component
      return(
        <div>
          <div className="hdr">
            <h2 className="proj-list-header">Select a project</h2>
            <div className="add-btn" onClick={() => {this.setState({isCreateProjectDialogVisible : true,});}}>
              <img src="images/svg/Add_Button.svg" alt="add project button" />
            </div>
          </div>
        <ul>
          {items}
        </ul>
        {createProjectDialog}
        {failedMessage}
      </div>
      );
    }
  }
  ReactDOM.render(<ElbeGuiApp />, document.getElementById('root'));
  </script>
</div>
<footer>
  <div class="social-icons">Icons</div>
  <div class="copyright">COPYRIGHT 2019 Â© MARTIN STEIH</div>
</footer>
</body>
</html>
